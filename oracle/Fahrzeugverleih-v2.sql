ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;

-- Rolle "standard_role" mit Rechten erstellen, falls sie noch nicht existiert.
-- Den Benutzer "FZV" löschen, falls er schon existiert.
DECLARE
    v_count NUMBER;
    v_role_name VARCHAR2(30) := 'standard_role';
    v_username VARCHAR2(30) := 'FZV';
BEGIN
    SELECT COUNT(*) INTO v_count FROM DBA_ROLES WHERE ROLE = UPPER(v_role_name);

    IF v_count = 0 THEN
        EXECUTE IMMEDIATE 'CREATE ROLE ' || v_role_name;    
        EXECUTE IMMEDIATE 'GRANT  CREATE session, CREATE table, CREATE view, CREATE procedure, CREATE synonym, CREATE sequence, CREATE trigger, CREATE any index, SELECT any table TO standard_role';
    END IF;

    SELECT COUNT(*) INTO v_count FROM DBA_USERS WHERE USERNAME = UPPER(v_username);

    IF v_count > 0 THEN
        EXECUTE IMMEDIATE 'DROP USER ' || v_username || ' CASCADE';
    END IF;
END;

-- Der Benutzer "FZV" wird erstellt (mit dem Passwort "FZV")
CREATE USER FZV IDENTIFIED BY FZV
       DEFAULT TABLESPACE users
       TEMPORARY TABLESPACE temp
       QUOTA UNLIMITED ON users;

-- Dem User "FZV" wird die zuvor erstelle Rolle "standard_role" zugewiesen.
GRANT standard_role TO FZV;

-- Wechsel in das Schema
ALTER SESSION SET CURRENT_SCHEMA = FZV;

CREATE TABLE Kunde (
    PK_Kunde_ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 100 INCREMENT BY 1),
    Vorname     VARCHAR2(255) NOT NULL,
    Nachname    VARCHAR2(255) NOT NULL,
    CONSTRAINT PKC_Kunde PRIMARY KEY (PK_Kunde_ID)
);

CREATE TABLE Fuehrerschein (
    PK_Klasse CHAR(3),
    Langbezeichnung VARCHAR2(255) NOT NULL,
    CONSTRAINT PKC_Fuehrerschein PRIMARY KEY (PK_Klasse)
);

CREATE TABLE Kunde_Fuehrerschein (
    PK_FK_Klasse   CHAR(3),
    PK_FK_Kunde_ID INTEGER,
    CONSTRAINT PKC_Kunde_Fuehrerschein PRIMARY KEY (PK_FK_Klasse, PK_FK_Kunde_ID),
    CONSTRAINT FKC_Kunde_Fuehrerschein_Fuehrerschein FOREIGN KEY (PK_FK_Klasse) REFERENCES Fuehrerschein (PK_Klasse),
    CONSTRAINT FKC_Kunde_Fuehrerschein_Kunde FOREIGN KEY (PK_FK_Kunde_ID) REFERENCES Kunde (PK_Kunde_ID) ON DELETE CASCADE
);

CREATE TABLE Marke (
    PK_Marke_ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 100 INCREMENT BY 1),
    Bezeichnung VARCHAR2(255) UNIQUE NOT NULL,
    CONSTRAINT PKC_Marke PRIMARY KEY (PK_Marke_ID)
);

CREATE TABLE Fahrzeug (
    PK_Fahrzeug_ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 100 INCREMENT BY 1),
    FK_Marke_ID    INTEGER NOT NULL,
    Modell         VARCHAR2(255),
    Preis          NUMBER(8, 2),
    FK_Klasse      CHAR(3),
    CONSTRAINT PKC_Fahrzeug PRIMARY KEY (PK_Fahrzeug_ID),
    CONSTRAINT FKC_Fahrzeug_Marke FOREIGN KEY (FK_Marke_ID) REFERENCES Marke (PK_Marke_ID) ON DELETE CASCADE,
    CONSTRAINT FKC_Fahrzeug_Fuehrerschein FOREIGN KEY (FK_Klasse) REFERENCES Fuehrerschein (PK_Klasse)
);

CREATE TABLE PKW (
    PK_FK_Fahrzeug_ID INTEGER,
    HatKlima       NUMBER(1),
    AnzahlTueren   INTEGER,
    CONSTRAINT PKC_PKW PRIMARY KEY (PK_FK_Fahrzeug_ID),
    CONSTRAINT FKC_PKW_Fahrzeug FOREIGN KEY (PK_FK_Fahrzeug_ID) REFERENCES Fahrzeug (PK_Fahrzeug_ID) ON DELETE CASCADE
);

CREATE TABLE LKW (
    PK_FK_Fahrzeug_ID INTEGER,
    Gewicht        NUMBER(8, 2),
    Sitze          INTEGER,
    CONSTRAINT PKC_LKW PRIMARY KEY (PK_FK_Fahrzeug_ID),
    CONSTRAINT FKC_LKW_Fahrzeug FOREIGN KEY (PK_FK_Fahrzeug_ID) REFERENCES Fahrzeug (PK_Fahrzeug_ID) ON DELETE CASCADE
);

CREATE TABLE Kunde_Fahrzeug (
    PK_FK_Kunde_ID    INTEGER,
    PK_FK_Fahrzeug_ID INTEGER,
    DatumVon          DATE,
    DatumBis          DATE,
    CONSTRAINT PKC_Kunde_Fahrzeug PRIMARY KEY (PK_FK_Kunde_ID, PK_FK_Fahrzeug_ID),
    CONSTRAINT FKC_Kunde_Fahrzeug_Kunde FOREIGN KEY (PK_FK_Kunde_ID) REFERENCES Kunde (PK_Kunde_ID),
    CONSTRAINT FKC_Kunde_Fahrzeug_Fahrzeug FOREIGN KEY (PK_FK_Fahrzeug_ID) REFERENCES Fahrzeug (PK_FAHRZEUG_ID)
);

INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (1,'Stefan', 'Buchberger');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (2,'Tobias', 'Eule');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (3,'Angelika', 'Polly');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (4,'Franz', 'Staudinger');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (5,'Margit', 'Eckenfellner');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (6,'Fritz', 'Hof');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (7,'Daniel', 'Billa');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (8,'Karl', 'Sparer');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (9,'Hermann', 'Dazinger');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (10,'Barbara', 'Freund');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (11,'Yuri', 'Popofic');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (12,'Christian', 'Bruder');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (13,'Manuel', 'Paul');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (14,'Maria', 'Ausland');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (15,'Lisa', 'Rabe');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (16,'Eva', 'Gesarovitsch');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (17,'Magdalena', 'Weigl');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (18,'Robert', 'Springer');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (19,'Sabine', 'Buchberger');
INSERT INTO Kunde (PK_Kunde_ID, Vorname, Nachname) VALUES (20,'Christian', 'Irgendwas');


INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('A', 'Motorrad');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('B', 'PKW');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('C', 'LKW');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('D', 'Minibus');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('E', 'Anhänger');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('AM', 'Motorfahrrad');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('BE', 'PKW');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('D1', 'Van');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('A1', 'Mottorrad');
INSERT INTO Fuehrerschein (PK_Klasse, Langbezeichnung) VALUES ('F', 'Traktor');

INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,1);
INSERT INTO Kunde_Fuehrerschein VALUES ('A' ,1);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,1);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,2);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,2);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,3);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,3);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,4);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,5);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,5);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,6);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,7);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,7);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,8);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,9);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,9);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,10);
INSERT INTO Kunde_Fuehrerschein VALUES ('F' ,10);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,11);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,12);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,13);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,14);
INSERT INTO Kunde_Fuehrerschein VALUES ('E' ,15);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,16);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,16);
INSERT INTO Kunde_Fuehrerschein VALUES ('A' ,17);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,17);
INSERT INTO Kunde_Fuehrerschein VALUES ('C' ,17);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,19);
INSERT INTO Kunde_Fuehrerschein VALUES ('B' ,20);


INSERT INTO Marke VALUES (1, 'VW');
INSERT INTO Marke VALUES (2, 'Audi');
INSERT INTO Marke VALUES (3, 'BMW');
INSERT INTO Marke VALUES (4, 'Fiat');
INSERT INTO Marke VALUES (5, 'Mercedes');
INSERT INTO Marke VALUES (6, 'Jaguar');
INSERT INTO Marke VALUES (7, 'Ferrari');

INSERT INTO Fahrzeug VALUES (1, 2,'A3',33000.20, 'B');
INSERT INTO Fahrzeug VALUES (2,3, 'i4',34000.30, 'B');
INSERT INTO Fahrzeug VALUES (3, 4,'500',35000.40, 'B');
INSERT INTO Fahrzeug VALUES (4,5, 'SL500',35555.20, 'B');
INSERT INTO Fahrzeug VALUES (5,6, 'F-Pace',696969.55, 'B');
INSERT INTO Fahrzeug VALUES (6,5, 'EQA',0800800.63, 'B');
INSERT INTO Fahrzeug VALUES (7,7, 'Roma',123456, 'B');
INSERT INTO Fahrzeug VALUES (8,3, 'M5',23103, 'B');
INSERT INTO Fahrzeug VALUES (9,1, 'ID.4',80000.29, 'B');
INSERT INTO Fahrzeug VALUES (31,2, 'A5',50000.20, 'C');
INSERT INTO Fahrzeug VALUES (32,3, 'iX',32000.30, 'C');
INSERT INTO Fahrzeug VALUES (33,4, 'Panda',21000.40, 'C');
INSERT INTO Fahrzeug VALUES (34,5, 'G 580 EQ',3000.20, 'C');
INSERT INTO Fahrzeug VALUES (35,6, 'I-Pace',80000.55, 'C');
INSERT INTO Fahrzeug VALUES (36,5, 'CLE',18000.63, 'C');
INSERT INTO Fahrzeug VALUES (37,7, 'Purosangue',30000.22, 'C');
INSERT INTO Fahrzeug VALUES (38,3, 'Z4',40000.28, 'C');
INSERT INTO Fahrzeug VALUES (39,1, 'ID. Buzz',50200.29, 'C');
INSERT INTO Fahrzeug VALUES (40,1, 'Golf',80000.89, 'C');

INSERT INTO PKW VALUES (1, 1, 1);
INSERT INTO PKW VALUES (2, 1, 2);
INSERT INTO PKW VALUES (3, 1, 3);
INSERT INTO PKW VALUES (4, 1, 4);
INSERT INTO PKW VALUES (5, 1, 5);
INSERT INTO PKW VALUES (6, 0, 1);
INSERT INTO PKW VALUES (7, 0, 2);
INSERT INTO PKW VALUES (8, 0, 3);
INSERT INTO PKW VALUES (9, 0, 4);

INSERT INTO LKW VALUES (31, 2003, 3);
INSERT INTO LKW VALUES (32, 3500, 4);
INSERT INTO LKW VALUES (33, 3700, 2);
INSERT INTO LKW VALUES (34, 3900, 2);
INSERT INTO LKW VALUES (35, 2750, 4);
INSERT INTO LKW VALUES (36, 3500, 5);
INSERT INTO LKW VALUES (37, 3500, 3);
INSERT INTO LKW VALUES (38, 3500, 3);
INSERT INTO LKW VALUES (39, 3500, 4);
INSERT INTO LKW VALUES (40, 3500, 2);

INSERT INTO Kunde_Fahrzeug VALUES ( 1, 40, DATE'2014-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 2,  2, DATE'2013-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 3,  3, DATE'2012-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 4,  4, DATE'2011-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 5,  5, DATE'2010-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 6,  6, DATE'2009-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 7,  8, DATE'2008-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 8,  8, DATE'2007-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 9, 39, DATE'2006-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES (10, 40, DATE'2005-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES (12, 31, DATE'2004-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 2, 32, DATE'2003-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 3, 33, DATE'2002-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 4, 34, DATE'2001-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 5, 35, DATE'2000-01-01', DATE'2014-01-02');
INSERT INTO Kunde_Fahrzeug VALUES ( 6, 36, DATE'1999-01-01', NULL);

COMMIT;